<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reels Tracker</title>
  <!-- Prefer PNG for Safari; SVG for others -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="mask-icon" href="favicon.svg" color="#be123c">
  <script>
    // Safari doesn't reliably support SVG favicons. Generate a PNG fallback.
    (function () {
      var ua = navigator.userAgent;
      var isSafari = /Safari\//.test(ua) && !/Chrome\//.test(ua) && !/Chromium\//.test(ua);
      if (!isSafari) return;
      try {
        var c = document.createElement('canvas');
        c.width = 64; c.height = 64;
        var ctx = c.getContext('2d');
        var g = ctx.createLinearGradient(0, 0, 64, 64);
        g.addColorStop(0, '#fecdd3');
        g.addColorStop(1, '#fda4af');
        ctx.fillStyle = g; ctx.fillRect(0, 0, 64, 64);
        // Heart
        ctx.fillStyle = '#be123c';
        ctx.beginPath();
        ctx.moveTo(32, 50);
        ctx.bezierCurveTo(20, 41, 12, 33, 12, 23);
        ctx.bezierCurveTo(12, 15, 18, 11, 24, 11);
        ctx.bezierCurveTo(28, 11, 31, 13, 32, 16);
        ctx.bezierCurveTo(33, 13, 36, 11, 40, 11);
        ctx.bezierCurveTo(46, 11, 52, 15, 52, 23);
        ctx.bezierCurveTo(52, 33, 44, 41, 32, 50);
        ctx.closePath();
        ctx.fill();
        var png = c.toDataURL('image/png');
        var linkPng = document.createElement('link');
        linkPng.rel = 'icon';
        linkPng.type = 'image/png';
        linkPng.sizes = '32x32';
        linkPng.href = png;
        document.head.appendChild(linkPng);
        var apple = document.createElement('link');
        apple.rel = 'apple-touch-icon';
        apple.href = png;
        document.head.appendChild(apple);
      } catch (e) { /* ignore */ }
    })();
  </script>
  <meta name="theme-color" content="#ffe4e6">
  <style>
    :root {
      /* Rose/pink romantic theme */
      --bg: #fff1f2;          /* rose-50 */
      --panel: #ffffff;
      --border: #ffe4e6;      /* rose-100 */
      --text: #3f1d2e;        /* deep rosy text */
      --muted: #9f8ca1;       /* soft mauve */

      /* Positive (Didn't watch) ‚Äî keep green */
      --green-bg: #dcfce7;    /* green-100 */
      --green-border: #86efac;/* green-300 */
      --green-text: #166534;  /* green-800 */

      /* Negative (Watched) ‚Äî deeper rose */
      --red-bg: #fecdd3;      /* rose-200 */
      --red-border: #fb7185;  /* rose-400 */
      --red-text: #be123c;    /* rose-700 */

      /* Neutral cells */
      --gray-bg: #fff7f9;     /* very light pink */
      --gray-border: #ffe4e6; /* rose-100 */
      --gray-text: #9f8ca1;   /* soft mauve */
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .container { max-width: 900px; margin: 0 auto; padding: 24px; }
    header h1 { margin: 0; font-size: 28px; letter-spacing: -0.02em; }
    header p { margin: 6px 0 0; color: var(--muted); }

    .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 20px; padding: 20px; box-shadow: 0 1px 2px rgba(0,0,0,0.04); }
    .row { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; }
    .subtle { text-transform: uppercase; letter-spacing: .06em; color: var(--muted); font-size: 12px; }
    .today { font-size: 22px; font-weight: 600; }
    .buttons { display: flex; gap: 8px; }
    .btn { padding: 10px 14px; border-radius: 12px; border: 1px solid var(--border); background: #fff; font-size: 14px; cursor: pointer; }
    .btn:hover { background: #fff1f2; }
    .btn-green { background: var(--green-bg); border-color: var(--green-border); color: var(--green-text); }
    .btn-red { background: var(--red-bg); border-color: var(--red-border); color: var(--red-text); }
    .btn-ghost { color: var(--muted); background: transparent; }

    .stats { display: grid; grid-template-columns: repeat(1, minmax(0,1fr)); gap: 10px; }
    @media (min-width: 640px) { .stats { grid-template-columns: repeat(3, minmax(0,1fr)); } }
    .stat { background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 12px; }
    .stat .label { font-size: 12px; text-transform: uppercase; letter-spacing: .06em; color: var(--muted); }
    .stat .value { font-size: 18px; font-weight: 600; margin-top: 2px; }
    .stat .hint { font-size: 12px; color: var(--muted); margin-top: 4px; }

    h2 { font-size: 18px; margin: 24px 0 10px; }
    .months { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 6px; }
    /* grid-template-columns is ignored since .months is flex now; kept for backward compatibility */
    @media (min-width: 900px) { .months { gap: 12px; } }
    .month { background: #fff; border: 1px solid var(--border); border-radius: 20px; padding: 12px; min-width: 260px; }
    .month-head { display: flex; align-items: baseline; justify-content: space-between; margin-bottom: 6px; }
    .weekday { font-size: 10px; color: #94a3b8; text-transform: uppercase; text-align: center; }
    .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
    .cell { aspect-ratio: 1 / 1; display: flex; align-items: center; justify-content: center; font-size: 13px; border: 1px solid var(--gray-border); border-radius: 10px; color: var(--gray-text); background: var(--gray-bg); cursor: pointer; user-select: none; }
    .cell.green { background: var(--green-bg); color: var(--green-text); border-color: var(--green-border); }
    .cell.red { background: var(--red-bg); color: var(--red-text); border-color: var(--red-border); }
    .cell.selected { outline: 2px solid #fb7185; outline-offset: 2px; }
    .legend { display: flex; gap: 16px; align-items: center; color: var(--muted); font-size: 14px; margin-top: 8px; }
    .dot { width: 16px; height: 16px; border-radius: 6px; border: 1px solid var(--gray-border); background: var(--gray-bg); display: inline-block; margin-right: 6px; vertical-align: -3px; }
    .dot.green { background: var(--green-bg); border-color: var(--green-border); }
    .dot.red { background: var(--red-bg); border-color: var(--red-border); }
    footer { color: var(--muted); font-size: 12px; margin-top: 18px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Reels Tracker made with love ü•∞ </h1>
      <p>This is a Reels Tracker built by Theodor lovely girlfriend, Satya Libert ‚ù§Ô∏è <br><br>
        </header>

    <section class="panel" id="today-panel">
      <div class="row">
        <div>
          <div class="subtle">Today</div>
          <div class="today" id="today-label"></div>
        </div>
        <div class="buttons">
          <button class="btn" id="btn-good">I <b>didn't</b> watch</button>
          <button class="btn" id="btn-bad">I watched</button>
          <button class="btn btn-ghost" id="btn-undo" style="display:none">Undo</button>
        </div>
      </div>
      <div class="stats" style="margin-top:12px">
        <div class="stat">
          <div class="label">Current streak</div>
          <div class="value" id="current-streak">0 days</div>
          <div class="hint" id="current-hint" style="display:none"></div>
        </div>
        <div class="stat">
          <div class="label">Best streak</div>
          <div class="value" id="best-streak">0 days</div>
        </div>
        <div class="stat">
          <div class="label">Today</div>
          <div class="value" id="today-status">Not set</div>
        </div>
      </div>
    </section>

    <section>
      <h2>History</h2>
      <div class="months" id="months"></div>
      <div class="legend">
        <span><span class="dot green"></span>Didn't watch</span>
        <span><span class="dot red"></span>Watched</span>
        <span><span class="dot"></span>No entry</span>
      </div>
    </section>

    <section class="panel" id="edit-panel" style="display:none; margin-top:12px">
      <div class="row">
        <div>
          <div class="subtle">Edit day</div>
          <div class="today" id="edit-label"></div>
        </div>
        <div class="buttons">
          <button class="btn" id="edit-good">Didn't watch</button>
          <button class="btn" id="edit-bad">Watched</button>
          <button class="btn btn-ghost" id="edit-clear">Clear</button>
          <button class="btn btn-ghost" id="edit-close">Close</button>
        </div>
      </div>
    </section>

    <footer>Hey babe, remember that your the data is stored locally in the browser so please don't clear ‚Äúsite data‚Äù or localStorage üòò</footer>
  </div>

  <script>
    (function() {
      const TZ = 'Europe/Copenhagen';
      const STORAGE_KEY = 'reels-tracker-v1';
      const MONTHS_TO_SHOW = 12; // includes current month
      const todayKey = (date = new Date()) =>
        date.toLocaleDateString('en-CA', { timeZone: TZ });
      const addDays = (date, n) => { const d = new Date(date); d.setDate(d.getDate() + n); return d; };
      const startOfMonth = (date) => { const d = new Date(date); d.setDate(1); d.setHours(0,0,0,0); return d; };
      const endOfMonth = (date) => { const d = new Date(date); d.setMonth(d.getMonth() + 1); d.setDate(0); d.setHours(23,59,59,999); return d; };
      const monthLabel = (date) => date.toLocaleDateString(undefined, { month: 'long', year: 'numeric', timeZone: TZ });
      const getMonthDays = (date) => { const start = startOfMonth(date); const days = []; const last = endOfMonth(date).getDate(); for (let i=1;i<=last;i++){const d=new Date(start); d.setDate(i); days.push(d);} return days; };
      const weekdayIndexMon0 = (date) => (date.getDay() + 6) % 7; // Mon=0

      function loadData() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return { entries: {}, bestStreak: 0 };
          const obj = JSON.parse(raw);
          return { entries: obj.entries || {}, bestStreak: obj.bestStreak || 0 };
        } catch {
          return { entries: {}, bestStreak: 0 };
        }
      }
      function saveData(data) { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }

      let state = loadData();
      let selectedKey = null; // YYYY-MM-DD when editing a past day

      function recomputeBest(map) {
        const daysBack = 730;
        let best = 0, streak = 0;
        for (let i = 0; i <= daysBack; i++) {
          const d = addDays(new Date(), -i);
          const key = todayKey(d);
          if (map[key] === true) { streak += 1; if (streak > best) best = streak; }
          else { streak = 0; }
        }
        return best;
      }

      function computeCurrentStreak(entries) {
        const todayStatus = entries[todayKey()];
        let streak = 0;
        const startDate = todayStatus === true ? new Date() : addDays(new Date(), -1);
        let cursor = todayKey(startDate);
        while (entries[cursor] === true) {
          streak += 1;
          const d = new Date(startDate);
          d.setDate(startDate.getDate() - streak);
          cursor = todayKey(d);
        }
        return streak;
      }

      function setSelected(key) {
        selectedKey = key;
        const editPanel = document.getElementById('edit-panel');
        if (selectedKey) {
          const d = new Date(selectedKey);
          document.getElementById('edit-label').textContent = d.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric', timeZone: TZ });
          editPanel.style.display = 'block';
        } else {
          editPanel.style.display = 'none';
        }
      }

      // Used to keep the initial view focused on the newest month
      let didInitialAutoScroll = false;

      function render() {
        // Today label
        const todayStr = new Date().toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric', timeZone: TZ });
        document.getElementById('today-label').textContent = todayStr;

        // Stats
        const today = todayKey();
        const todayStatus = state.entries[today];
        const cur = computeCurrentStreak(state.entries);
        const projected = todayStatus === undefined ? cur + 1 : cur;
        document.getElementById('current-streak').textContent = cur + ' day' + (cur === 1 ? '' : 's');
        const hintEl = document.getElementById('current-hint');
        if (todayStatus === undefined) { hintEl.style.display = 'block'; hintEl.textContent = 'Mark today to reach ' + projected; } else { hintEl.style.display = 'none'; }
        document.getElementById('best-streak').textContent = state.bestStreak + ' days';
        document.getElementById('today-status').textContent = todayStatus === true ? "Didn't watch" : todayStatus === false ? 'Watched' : 'Not set';

        // Buttons state
        const btnGood = document.getElementById('btn-good');
        const btnBad = document.getElementById('btn-bad');
        const btnUndo = document.getElementById('btn-undo');
        btnUndo.style.display = todayStatus === undefined ? 'none' : 'inline-block';
        btnGood.classList.toggle('btn-green', todayStatus === true);
        btnBad.classList.toggle('btn-red', todayStatus === false);

        // Months grids
        const monthsEl = document.getElementById('months');
        monthsEl.innerHTML = '';
        // Oldest -> newest (left to right), show more months with horizontal scroll
        const monthDates = Array.from({ length: MONTHS_TO_SHOW }, (_, i) => {
          const d = new Date();
          d.setDate(1);
          // Compute oldest first: (MONTHS_TO_SHOW-1) months ago up to 0 (current)
          d.setMonth(d.getMonth() - (MONTHS_TO_SHOW - 1 - i));
          return d;
        });
        monthDates.forEach((monthDate) => {
          const wrap = document.createElement('div');
          wrap.className = 'month';

          const head = document.createElement('div'); head.className = 'month-head';
          const title = document.createElement('div'); title.style.fontWeight = '600'; title.textContent = monthLabel(monthDate);
          const monsun = document.createElement('div'); monsun.style.fontSize = '12px'; monsun.style.color = '#94a3b8'; monsun.textContent = 'Mon‚ÄìSun';
          head.appendChild(title); head.appendChild(monsun); wrap.appendChild(head);

          const grid = document.createElement('div'); grid.className = 'grid';
          'MTWTFSS'.split('').forEach(ch => { const w = document.createElement('div'); w.className = 'weekday'; w.textContent = ch; grid.appendChild(w); });
          const days = getMonthDays(monthDate);
          const pad = weekdayIndexMon0(days[0]);
          for (let i=0;i<pad;i++){ grid.appendChild(document.createElement('div')); }
          days.forEach((d) => {
            const cell = document.createElement('div');
            const key = todayKey(d);
            const status = state.entries[key];
            cell.className = 'cell' + (status === true ? ' green' : status === false ? ' red' : '') + (selectedKey === key ? ' selected' : '');
            const tt = (d.toLocaleDateString(undefined, { day: 'numeric', month: 'short', timeZone: TZ })) + ' ‚Äî ' + (status === true ? "Didn't watch" : status === false ? 'Watched' : 'No entry');
            cell.title = tt; cell.textContent = d.getDate();
            cell.addEventListener('click', function () { setSelected(key); render(); });
            grid.appendChild(cell);
          });
          wrap.appendChild(grid);
          monthsEl.appendChild(wrap);
        });
        // Keep view focused on the newest months on first load
        if (!didInitialAutoScroll) { monthsEl.scrollLeft = monthsEl.scrollWidth; didInitialAutoScroll = true; }
      }

      // Actions
      document.getElementById('btn-good').addEventListener('click', function() {
        const key = todayKey();
        state.entries[key] = true;
        state.bestStreak = recomputeBest(state.entries);
        saveData(state);
        render();
      });
      document.getElementById('btn-bad').addEventListener('click', function() {
        const key = todayKey();
        state.entries[key] = false;
        state.bestStreak = recomputeBest(state.entries);
        saveData(state);
        render();
      });
      document.getElementById('btn-undo').addEventListener('click', function() {
        const key = todayKey();
        delete state.entries[key];
        state.bestStreak = recomputeBest(state.entries);
        saveData(state);
        render();
      });

      // Initial render
      render();

      // Auto-refresh at day/month rollover and when tab becomes visible
      let lastToday = todayKey();
      setInterval(() => {
        const cur = todayKey();
        if (cur !== lastToday) { lastToday = cur; render(); }
      }, 60000);
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') { render(); }
      });

      // Edit panel actions
      document.getElementById('edit-good').addEventListener('click', function () {
        if (!selectedKey) return;
        state.entries[selectedKey] = true;
        state.bestStreak = recomputeBest(state.entries);
        saveData(state);
        setSelected(null);
        render();
      });
      document.getElementById('edit-bad').addEventListener('click', function () {
        if (!selectedKey) return;
        state.entries[selectedKey] = false;
        state.bestStreak = recomputeBest(state.entries);
        saveData(state);
        setSelected(null);
        render();
      });
      document.getElementById('edit-clear').addEventListener('click', function () {
        if (!selectedKey) return;
        delete state.entries[selectedKey];
        state.bestStreak = recomputeBest(state.entries);
        saveData(state);
        setSelected(null);
        render();
      });
      document.getElementById('edit-close').addEventListener('click', function () {
        setSelected(null);
        render();
      });
    })();
  </script>
</body>
</html>
